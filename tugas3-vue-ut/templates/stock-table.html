<div class="card">
  <h2>ðŸ“¦ Stok Bahan Ajar</h2>

  <div class="controls" style="justify-content:space-between;">
    <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
      <button class="primary" @click="openAdd">+ Tambah Bahan Ajar</button>

      <div style="min-width:200px;">
        <select v-model="filterUPBJJ">
          <option value="">â€” Semua UT-Daerah â€”</option>
          <option v-for="u in upbjjList" :key="u" :value="u">{{ u }}</option>
        </select>
      </div>

      <div style="min-width:200px;">
        <select v-model="filterKategori" :disabled="!filterUPBJJ">
          <option value="">â€” Semua Kategori â€”</option>
          <option v-for="k in kategoriListForUPBJJ" :key="k" :value="k">{{ k }}</option>
        </select>
      </div>

      <label style="display:flex; align-items:center; gap:6px;">
        <input type="checkbox" v-model="filterWarning">
        <span>Hanya qty &lt; safety atau qty = 0</span>
      </label>

      <button class="secondary" @click="resetFilters">Reset</button>
    </div>

    <div style="font-size:13px; color:#556;">
      <em>Klik header <strong>Judul / Harga / Qty</strong> untuk mengurutkan</em>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th @click="setSort('kode')">Kode</th>
        <th @click="setSort('judul')">Judul</th>
        <th>Kategori</th>
        <th>UPBJJ</th>
        <th>Rak</th>
        <th @click="setSort('harga')">Harga</th>
        <th @click="setSort('qty')">Qty</th>
        <th>Safety</th>
        <th>Status</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="item in stok" :key="item.kode">
        <td>{{ item.kode }}</td>
        <td>{{ item.judul }}</td>
        <td>{{ item.kategori }}</td>
        <td>{{ item.upbjj }}</td>
        <td>{{ item.lokasiRak }}</td>
        <td>{{ formatCurrency(item.harga) }}</td>
        <td>{{ item.qty }} buah</td>
        <td>{{ item.safety }} buah</td>
        <td class="status-cell"
            @mouseenter="showCatatan($event, item.catatanHTML)"
            @mouseleave="hideCatatan">
          <status-badge :qty="item.qty" :safety="item.safety"></status-badge>
        </td>
        <td>
          <button class="secondary" @click="openEdit(item)">Edit</button>
          <button class="secondary" @click="confirmDelete(item)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- tooltip -->
  <div v-if="showTooltip" class="tooltip" :style="{ left: tooltipX + 'px', top: tooltipY + 'px' }" v-html="tooltipHtml"></div>

  <!-- Add/Edit Modal uses app-modal -->
  <app-modal :show="modalShow" :title="modalTitle" @close="modalClose" @ok="modalOk">
    <div>
      <label>Kode</label>
      <input v-model="form.kode" :disabled="isEdit">

      <label>Judul</label>
      <input v-model="form.judul" @keyup.enter="modalOk">

      <label>Kategori</label>
      <select v-model="form.kategori">
        <option value="" disabled>â€” Pilih â€”</option>
        <option v-for="k in kategoriList" :key="k" :value="k">{{ k }}</option>
      </select>

      <label>UPBJJ</label>
      <select v-model="form.upbjj">
        <option value="" disabled>â€” Pilih â€”</option>
        <option v-for="u in upbjjList" :key="u" :value="u">{{ u }}</option>
      </select>

      <label>Lokasi Rak</label>
      <input v-model="form.lokasiRak">

      <label>Harga (angka)</label>
      <input v-model.number="form.harga" @keyup.enter="modalOk">

      <label>Qty</label>
      <input v-model.number="form.qty" @keyup.enter="modalOk">

      <label>Safety</label>
      <input v-model.number="form.safety" @keyup.enter="modalOk">

      <label>Catatan (HTML)</label>
      <input v-model="form.catatanHTML">
    </div>
  </app-modal>

  <!-- Delete confirm -->
  <app-modal :show="deleteShow" title="Konfirmasi Hapus" @close="deleteShow=false" @ok="doDelete">
    <div>
      <p>Yakin menghapus <strong>{{ toDelete?.kode }}</strong> â€” {{ toDelete?.judul }} ?</p>
    </div>
  </app-modal>
</div>